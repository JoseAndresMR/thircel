<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>31 D√≠as de Celebraci√≥n</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, doc, getDoc, updateDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import {
      getAuth, signInWithEmailAndPassword
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBGZnLfG1w-2gipGRAVNqF2S9Zk7xsAePM",
      authDomain: "diasdecelebracion-3783e.firebaseapp.com",
      projectId: "diasdecelebracion-3783e",
      storageBucket: "diasdecelebracion-3783e.firebasestorage.app",
      messagingSenderId: "230965566412",
      appId: "1:230965566412:web:d6e1bb64654a9e60969b69"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Fecha actual del calendario real
    const today = new Date();
    const day = today.getDate();

    const container = document.getElementById("card-container");

    async function mostrarTarjeta(dia) {
      const ref = doc(db, "tarjetas", `dia-${dia}`);
      const snap = await getDoc(ref);
      if (snap.exists() && snap.data().visible) {
        const data = snap.data();
        container.innerHTML = `
          <div class="card">
            <h2>${data.titulo}</h2>
            <p>${data.descripcion}</p>
            <button onclick="marcarUsada(${dia})">Marcar como usada</button>
          </div>
        `;
      } else {
        container.innerHTML = `<p>No hay tarjeta disponible a√∫n para hoy.</p>`;
      }
    }

    async function marcarUsada(dia) {
      const ref = doc(db, "tarjetas", `dia-${dia}`);
      await updateDoc(ref, { usada: true });
      alert("¬°Tarjeta marcada como usada!");
    }

    const loginForm = document.getElementById("admin-login");
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = e.target.email.value;
      const password = e.target.password.value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        alert("Login correcto. Puedes administrar tarjetas.");
        // Aqu√≠ luego ir√° el panel de admin
      } catch (err) {
        alert("Error al iniciar sesi√≥n: " + err.message);
      }
    });

    const passwordScreen = document.getElementById("password-screen");
    const CLAVE_CORRECTA = "kirita";

    function verificarClave() {
      const clave = document.getElementById("clave").value;
      if (clave === CLAVE_CORRECTA) {
        localStorage.setItem("autenticadoCelebracion", "true");
        passwordScreen.style.display = "none";
        mostrarTarjeta(day); // ahora s√≠ carga la tarjeta del d√≠a
      } else {
        document.getElementById("error").innerText = "Contrase√±a incorrecta üòî";
      }
    }

    // üîì Hacerla accesible globalmente
    window.verificarClave = verificarClave;

    // Si ya se autentic√≥ antes
    if (localStorage.getItem("autenticadoCelebracion") === "true") {
      passwordScreen.style.display = "none";
      mostrarTarjeta(day);
    } else {
      container.innerHTML = "";
    }
  </script>

  <style>
    body { font-family: sans-serif; padding: 2em; background: #fffaf8; color: #333; }
    .card { border: 2px dashed #e89d9d; border-radius: 12px; padding: 1em; background: #fff0f5; }
    button { background: #e26a6a; color: white; border: none; padding: 0.5em 1em; border-radius: 8px; cursor: pointer; }
    button:hover { background: #c65555; }
  </style>
</head>
<body>
  <h1>üéâ 31 D√≠as de Celebraci√≥n üéâ</h1>

  <div id="password-screen">
    <h2>üîê Acceso privado</h2>
    <p>Introduce la contrase√±a que te dio Josmil üíå</p>
    <input type="password" id="clave" placeholder="Contrase√±a..." />
    <button onclick="verificarClave()">Entrar</button>
    <p id="error" style="color:red;"></p>
  </div>

  <div id="card-container">
    <p>Cargando tarjeta de hoy...</p>
  </div>

  <hr />
  <h3>Acceso administrador</h3>
  <form id="admin-login">
    <input type="email" name="email" placeholder="Tu email" required />
    <input type="password" name="password" placeholder="Contrase√±a" required />
    <button type="submit">Entrar</button>
  </form>
</body>
</html>
